RAG System Query Flow Diagram
==============================

┌─────────────────────────────────────────────────────────────────────────────┐
│                                FRONTEND                                     │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────────────┐  │
│  │   User Input    │───▶│  Send Message   │───▶│    Show Loading...      │  │
│  │   (script.js)   │    │   Function      │    │                         │  │
│  └─────────────────┘    └─────────────────┘    └─────────────────────────┘  │
└─────────────────────────────┬───────────────────────────────────────────────┘
                              │ POST /api/query
                              │ {query, session_id}
                              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                            FASTAPI LAYER                                   │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────────────┐  │
│  │  @app.post()    │───▶│ Create Session  │───▶│   Call RAG System       │  │
│  │  /api/query     │    │   (if needed)   │    │   rag_system.query()    │  │
│  │   (app.py:56)   │    │                 │    │                         │  │
│  └─────────────────┘    └─────────────────┘    └─────────────────────────┘  │
└─────────────────────────────┬───────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                        RAG SYSTEM ORCHESTRATOR                             │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────────────┐  │
│  │ Get Conversation│───▶│ Create Prompt   │───▶│  Call AI Generator      │  │
│  │    History      │    │ + Add Context   │    │  with Tools & History   │  │
│  │(session_manager)│    │                 │    │                         │  │
│  └─────────────────┘    └─────────────────┘    └─────────────────────────┘  │
│                                                              │               │
│  ┌─────────────────┐    ┌─────────────────┐                │               │
│  │ Update Session  │◀───│ Get Sources     │◀───────────────┘               │
│  │    History      │    │ from Tools      │                                │
│  │                 │    │                 │                                │
│  └─────────────────┘    └─────────────────┘                                │
└─────────────────────────────┬───────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           AI GENERATOR                                     │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────────────┐  │
│  │  First Claude   │───▶│  Tool Decision  │───▶│    Execute Search       │  │
│  │  API Call       │    │  (if needed)    │    │       Tool              │  │
│  │ (with tools)    │    │                 │    │                         │  │
│  └─────────────────┘    └─────────────────┘    └─────────────────────────┘  │
│                                                              │               │
│  ┌─────────────────┐    ┌─────────────────┐                │               │
│  │ Return Final    │◀───│ Second Claude   │◀───────────────┘               │
│  │   Response      │    │   API Call      │                                │
│  │                 │    │ (synthesize)    │                                │
│  └─────────────────┘    └─────────────────┘                                │
└─────────────────────────────┬───────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          SEARCH TOOLS                                      │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────────────┐  │
│  │CourseSearchTool │───▶│  Vector Store   │───▶│    ChromaDB             │  │
│  │   .execute()    │    │   .search()     │    │  Semantic Search        │  │
│  │                 │    │                 │    │                         │  │
│  └─────────────────┘    └─────────────────┘    └─────────────────────────┘  │
│                                                              │               │
│  ┌─────────────────┐    ┌─────────────────┐                │               │
│  │  Track Sources  │◀───│ Return Relevant │◀───────────────┘               │
│  │  in Manager     │    │   Chunks        │                                │
│  │                 │    │                 │                                │
│  └─────────────────┘    └─────────────────┘                                │
└─────────────────────────────────────────────────────────────────────────────┘

RESPONSE FLOW BACK:
==================
               Search Results
                     │
                     ▼
          ┌─────────────────────┐
          │   AI Synthesizes    │
          │   Final Answer      │
          └─────────────────────┘
                     │
                     ▼
          ┌─────────────────────┐
          │  RAG System Returns │
          │ (response, sources) │
          └─────────────────────┘
                     │
                     ▼
          ┌─────────────────────┐
          │   FastAPI Returns   │
          │   QueryResponse     │
          │      JSON           │
          └─────────────────────┘
                     │
                     ▼
          ┌─────────────────────┐
          │   Frontend Shows    │
          │  Answer + Sources   │
          │  Replace Loading    │
          └─────────────────────┘

DATA FLOW LEGEND:
================
───▶  Request/Call Flow
◀─── Response/Return Flow
│    Vertical Process Flow
▼    Downward Flow Direction

KEY COMPONENTS:
==============
• Frontend: User interface and interaction
• FastAPI: HTTP API layer and routing  
• RAG System: Main orchestration logic
• AI Generator: Claude API interaction with two-stage processing
• Search Tools: Semantic search on course materials
• ChromaDB: Vector database for document chunks